<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: headFragment}"></head>

<body class="font-display bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark min-h-screen">

    <!-- ì˜ˆì‹œ ì´ë¯¸ì§€ Tooltip ìŠ¤íƒ€ì¼ -->
    <style>
        .example-tooltip-wrapper {
            position: relative;
            display: inline-block;
        }

        .example-tooltip {
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 100;
            white-space: nowrap;
        }

        .example-tooltip-right {
            left: auto;
            right: 0;
            transform: translateX(0);
        }

        .example-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: white;
        }

        .example-tooltip-right::after {
            left: auto;
            right: 12px;
            transform: none;
        }

        .example-tooltip-wrapper:hover .example-tooltip {
            opacity: 1;
            visibility: visible;
        }

        @media (prefers-color-scheme: dark) {
            .example-tooltip {
                background: #1f2937;
                color: white;
            }

            .example-tooltip::after {
                border-top-color: #1f2937;
            }
        }
    </style>

    <!-- Header -->
    <header th:replace="~{fragments/header :: headerFragment}"></header>

    <!-- Main Content -->
    <main class="pt-20 pb-16 px-4">
        <div class="max-w-4xl mx-auto">

            <!-- Hero Section -->
            <section class="text-center py-12">
                <div
                    class="inline-flex items-center gap-2 px-4 py-2 bg-primary/10 rounded-full text-primary text-sm font-medium mb-6">
                    <span class="material-symbols-outlined text-lg">auto_awesome</span>
                    AI ìŠ¤ë§ˆíŠ¸ ë¶„ì„
                </div>
                <h1
                    class="text-4xl md:text-5xl font-black mb-4 bg-gradient-to-r from-primary via-violet-500 to-purple-600 bg-clip-text text-transparent">
                    ì˜ë¥˜ ìƒíƒœ ë¶„ì„
                </h1>
                <p class="text-text-light/60 dark:text-text-dark/60 max-w-md mx-auto">
                    AIê°€ ì˜ë¥˜ ìƒíƒœë¥¼ ë¶„ì„í•˜ê³  ë“±ê¸‰ì„ íŒì •í•©ë‹ˆë‹¤
                </p>
            </section>

            <!-- Upload Section - 2 Column Grid (66/33) -->
            <section id="upload-section" class="mb-8">
                <!-- Main Card Container -->
                <div
                    class="bg-white dark:bg-card-dark rounded-3xl shadow-xl border border-gray-100 dark:border-gray-800 overflow-hidden">
                    <div class="grid lg:grid-cols-3 gap-0">

                        <!-- Left Column (66%) - Upload Zones -->
                        <div class="lg:col-span-2 p-5 lg:p-6">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                                <span class="material-symbols-outlined text-primary text-2xl">cloud_upload</span>
                                ì‚¬ì§„ ì—…ë¡œë“œ
                            </h3>

                            <!-- Upload Boxes - Vertical Stack -->
                            <div class="space-y-4">
                                <!-- ì˜ë¥˜ ì‚¬ì§„ -->
                                <div id="clothing-drop-zone"
                                    class="group relative bg-gray-50 dark:bg-white/5 rounded-2xl border-2 border-dashed border-gray-200 dark:border-gray-700 hover:border-primary hover:bg-primary/5 transition-all cursor-pointer overflow-hidden h-40">
                                    <!-- Ghost Placeholder -->
                                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                        <span
                                            class="material-symbols-outlined text-[100px] text-gray-200 dark:text-gray-700">checkroom</span>
                                    </div>
                                    <input type="file" id="clothing-input" accept="image/*" class="hidden">
                                    <div id="clothing-placeholder"
                                        class="relative z-10 h-full flex flex-col items-center justify-center p-4">
                                        <div
                                            class="size-14 rounded-2xl bg-primary/10 flex items-center justify-center group-hover:scale-110 transition-transform mb-3">
                                            <span
                                                class="material-symbols-outlined text-3xl text-primary">add_photo_alternate</span>
                                        </div>
                                        <p class="text-lg font-bold text-gray-800 dark:text-white mb-1">ì˜ë¥˜ ì‚¬ì§„</p>
                                        <p class="text-sm text-gray-500">í´ë¦­ ë˜ëŠ” ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ</p>
                                        <div
                                            class="mt-3 inline-flex items-center gap-1.5 px-3 py-1 bg-primary/10 rounded-full">
                                            <span
                                                class="material-symbols-outlined text-sm text-primary">check_circle</span>
                                            <span class="text-sm font-medium text-primary">í•„ìˆ˜</span>
                                        </div>
                                    </div>
                                    <div id="clothing-preview"
                                        class="hidden relative z-10 h-full flex items-center justify-center p-4">
                                        <img id="clothing-img" class="max-h-full max-w-full object-contain rounded-xl">
                                        <button type="button" id="clothing-remove"
                                            class="absolute top-4 right-4 size-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center z-20 shadow-lg">
                                            <span class="material-symbols-outlined text-lg">close</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- ì¼€ì–´ë¼ë²¨ -->
                                <div id="label-drop-zone"
                                    class="group relative bg-gray-50 dark:bg-white/5 rounded-2xl border-2 border-dashed border-gray-200 dark:border-gray-700 hover:border-violet-400 hover:bg-violet-50 dark:hover:bg-violet-900/10 transition-all cursor-pointer overflow-hidden h-40">
                                    <!-- Ghost Placeholder -->
                                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                        <span
                                            class="material-symbols-outlined text-[100px] text-gray-200 dark:text-gray-700">sell</span>
                                    </div>
                                    <input type="file" id="label-input" accept="image/*" class="hidden">
                                    <div id="label-placeholder"
                                        class="relative z-10 h-full flex flex-col items-center justify-center p-4">
                                        <div
                                            class="size-14 rounded-2xl bg-violet-100 dark:bg-violet-900/30 flex items-center justify-center group-hover:scale-110 transition-transform mb-3">
                                            <span
                                                class="material-symbols-outlined text-3xl text-violet-500">add_photo_alternate</span>
                                        </div>
                                        <p class="text-lg font-bold text-gray-800 dark:text-white mb-1">ì¼€ì–´ë¼ë²¨ <span
                                                class="text-base font-normal text-gray-400">(ì„ íƒ)</span></p>
                                        <p class="text-sm text-gray-500">ì†Œì¬/ì„¸íƒ ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ì¶”ì¶œ</p>
                                    </div>
                                    <div id="label-preview"
                                        class="hidden relative z-10 h-full flex items-center justify-center p-4">
                                        <img id="label-img" class="max-h-full max-w-full object-contain rounded-xl">
                                        <button type="button" id="label-remove"
                                            class="absolute top-4 right-4 size-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center z-20 shadow-lg">
                                            <span class="material-symbols-outlined text-lg">close</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Analyze Button (Full Width) -->
                            <button id="analyze-btn"
                                class="w-full mt-4 py-3 bg-gradient-to-r from-primary to-violet-600 hover:from-primary/90 hover:to-violet-600/90 text-white font-bold text-lg rounded-2xl shadow-lg shadow-primary/30 transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="material-symbols-outlined text-2xl">rocket_launch</span>
                                ë¶„ì„ ì‹œì‘
                            </button>
                        </div>

                        <!-- Right Column (33%) - Instruction Panel -->
                        <div
                            class="lg:col-span-1 bg-gradient-to-br from-primary/5 to-violet-500/5 dark:from-primary/10 dark:to-violet-500/10 p-5 lg:p-6 border-t lg:border-t-0 lg:border-l border-gray-100 dark:border-gray-800">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                                <span class="material-symbols-outlined text-primary text-2xl">lightbulb</span>
                                ì¢‹ì€ ê²°ê³¼ë¥¼ ìœ„í•œ íŒ
                            </h3>

                            <!-- Good Examples -->
                            <div class="space-y-4">
                                <!-- Example 1: Clothing -->
                                <div class="flex items-start gap-3">
                                    <div
                                        class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0 border-2 border-green-400 shadow-sm">
                                        <img src="/images/examples/example_clothing.jpg" alt="ì¢‹ì€ ì˜ˆì‹œ"
                                            class="w-full h-full object-cover">
                                    </div>
                                    <div class="flex-1">
                                        <p
                                            class="font-bold text-base text-gray-800 dark:text-white flex items-center gap-2 mb-1">
                                            <span class="text-green-500 text-lg">âœ“</span> í‰í‰í•˜ê²Œ í¼ì³ì„œ
                                        </p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">ì˜· ì „ì²´ê°€ ë³´ì´ê²Œ, ë°ì€ ì¡°ëª…ì—ì„œ ì´¬ì˜í•˜ì„¸ìš”</p>
                                    </div>
                                </div>

                                <!-- Example 2: Label -->
                                <div class="flex items-start gap-3">
                                    <div
                                        class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0 border-2 border-green-400 shadow-sm bg-white">
                                        <img src="/images/examples/example_label.jpg" alt="ì¢‹ì€ ì˜ˆì‹œ"
                                            class="w-full h-full object-contain">
                                    </div>
                                    <div class="flex-1">
                                        <p
                                            class="font-bold text-base text-gray-800 dark:text-white flex items-center gap-2 mb-1">
                                            <span class="text-green-500 text-lg">âœ“</span> ê¸€ì”¨ê°€ ì„ ëª…í•˜ê²Œ
                                        </p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">ë¼ë²¨ ì „ì²´ê°€ ë³´ì´ë„ë¡ ê°€ê¹Œì´ì—ì„œ ì´¬ì˜í•˜ì„¸ìš”</p>
                                    </div>
                                </div>

                                <!-- Divider -->
                                <hr class="border-gray-200 dark:border-gray-700 my-4">

                                <!-- Tips - Avoid -->
                                <div class="space-y-3">
                                    <p
                                        class="text-base font-bold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                        <span class="material-symbols-outlined text-red-400 text-xl">block</span>
                                        í”¼í•´ì•¼ í•  ê²ƒ
                                    </p>
                                    <ul class="text-sm text-gray-500 dark:text-gray-400 space-y-2 ml-1">
                                        <li class="flex items-center gap-2">
                                            <span class="text-red-400 text-base">âœ—</span> ì–´ë‘ìš´ ê³³ì—ì„œ ì´¬ì˜
                                        </li>
                                        <li class="flex items-center gap-2">
                                            <span class="text-red-400 text-base">âœ—</span> ì˜·ì´ êµ¬ê²¨ì§„ ìƒíƒœ
                                        </li>
                                        <li class="flex items-center gap-2">
                                            <span class="text-red-400 text-base">âœ—</span> ë¼ë²¨ ê¸€ì”¨ê°€ íë¦¿í•¨
                                        </li>
                                    </ul>
                                </div>

                                <!-- Bottom Note -->
                                <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        <span
                                            class="material-symbols-outlined text-primary text-sm align-middle mr-1">tips_and_updates</span>
                                        <span class="text-primary font-medium">ê³ í™”ì§ˆ ì‚¬ì§„</span>ìœ¼ë¡œ AI ë¶„ì„ ì •í™•ë„ 30%â†‘
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Loading -->
            <section id="loading-section" class="hidden text-center py-20">
                <div class="size-20 mx-auto border-4 border-primary/20 border-t-primary rounded-full animate-spin mb-6">
                </div>
                <p class="font-bold text-primary animate-pulse">AIê°€ ì˜ë¥˜ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
                <p class="text-sm text-text-light/50 dark:text-text-dark/50 mt-2">ê²°í•¨ íƒì§€ ë° ìŠ¤íƒ€ì¼ ë¶„ë¥˜ ì¤‘</p>
            </section>

            <!-- Results Section -->
            <section id="result-section" class="hidden space-y-8">

                <!-- Grade & Images Row -->
                <div class="grid md:grid-cols-3 gap-6">
                    <!-- AI ë“±ê¸‰ -->
                    <div class="bg-card-light dark:bg-card-dark rounded-3xl p-6 text-center">
                        <p class="text-sm text-text-light/60 dark:text-text-dark/60 mb-3">AI ë“±ê¸‰ íŒì •</p>
                        <div id="grade-badge"
                            class="inline-flex items-center justify-center size-24 rounded-full text-4xl font-black text-white shadow-xl mb-3">
                            S
                        </div>
                        <p id="grade-score" class="text-2xl font-bold">100ì </p>
                        <p id="grade-recommendation" class="text-sm text-text-light/60 dark:text-text-dark/60">ê±°ì˜ ìƒˆê²ƒ</p>
                    </div>

                    <!-- ê²°í•¨ ë¶„ì„ ì´ë¯¸ì§€ -->
                    <div class="bg-card-light dark:bg-card-dark rounded-3xl p-6">
                        <p class="text-sm text-text-light/60 dark:text-text-dark/60 mb-3 flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg text-orange-500">search</span>
                            ê²°í•¨ ë¶„ì„
                        </p>
                        <img id="defect-img"
                            class="w-full aspect-square object-contain rounded-2xl bg-gray-100 dark:bg-gray-800">
                    </div>

                    <!-- ë°°ê²½ ì œê±° ì´ë¯¸ì§€ -->
                    <div class="bg-card-light dark:bg-card-dark rounded-3xl p-6">
                        <p class="text-sm text-text-light/60 dark:text-text-dark/60 mb-3 flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg text-green-500">content_cut</span>
                            ë°°ê²½ ì œê±°
                        </p>
                        <div
                            class="w-full aspect-square rounded-2xl bg-[url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2220%22 height=%2220%22%3E%3Crect width=%2210%22 height=%2210%22 fill=%22%23ccc%22/%3E%3Crect x=%2210%22 y=%2210%22 width=%2210%22 height=%2210%22 fill=%22%23ccc%22/%3E%3C/svg%3E')]">
                            <img id="nobg-img" class="w-full h-full object-contain">
                        </div>
                    </div>
                </div>

                <!-- Details Row -->
                <div class="grid md:grid-cols-3 gap-6">
                    <!-- ë°œê²¬ëœ ê²°í•¨ -->
                    <div class="bg-card-light dark:bg-card-dark rounded-3xl p-6">
                        <p class="text-sm text-text-light/60 dark:text-text-dark/60 mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg text-red-500">warning</span>
                            ë°œê²¬ëœ ê²°í•¨
                        </p>
                        <ul id="defect-list" class="space-y-2">
                            <li class="text-text-light/40">ê²°í•¨ ì—†ìŒ</li>
                        </ul>
                        <p class="text-xs text-text-light/30 dark:text-text-dark/30 mt-4">ì‹ ë¢°ë„ ê¸°ì¤€: conf â‰¥ 0.15</p>
                    </div>

                    <!-- K-Fashion ìŠ¤íƒ€ì¼ -->
                    <div class="bg-card-light dark:bg-card-dark rounded-3xl p-6">
                        <p class="text-sm text-text-light/60 dark:text-text-dark/60 mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg text-purple-500">style</span>
                            K-Fashion ìŠ¤íƒ€ì¼
                        </p>
                        <div id="style-tags" class="flex flex-wrap gap-2">
                            <span class="px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-medium">ë¶„ì„
                                ì¤‘</span>
                        </div>
                    </div>

                    <!-- ì¼€ì–´ë¼ë²¨ ì •ë³´ -->
                    <div class="bg-card-light dark:bg-card-dark rounded-3xl p-6">
                        <p class="text-sm text-text-light/60 dark:text-text-dark/60 mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg text-blue-500">label</span>
                            ì¼€ì–´ë¼ë²¨ ì •ë³´
                        </p>
                        <div id="tag-info" class="space-y-2 text-sm">
                            <p>ì¼€ì–´ë¼ë²¨ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ë¶„ì„ë©ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>

                <!-- ì„¸ë¶€ ì†ì„± -->
                <div class="bg-card-light dark:bg-card-dark rounded-3xl p-6">
                    <p class="text-sm text-text-light/60 dark:text-text-dark/60 mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined text-lg text-teal-500">category</span>
                        ì„¸ë¶€ ì†ì„±
                    </p>
                    <div id="attributes-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                    </div>
                </div>

                <!-- ì˜·ì¥ ë“±ë¡ í¼ -->
                <div class="bg-gradient-to-br from-primary/5 to-violet-500/5 rounded-3xl p-8 border border-primary/20">
                    <h3 class="font-bold text-lg mb-6 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">edit_note</span>
                        ì˜·ì¥ì— ë“±ë¡í•˜ê¸°
                    </h3>

                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label
                                class="text-xs font-medium text-text-light/60 dark:text-text-dark/60 mb-1 block">ì˜ë¥˜ëª…</label>
                            <input type="text" id="input-name"
                                class="w-full px-4 py-3 bg-white dark:bg-card-dark border border-border-light dark:border-border-dark rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                placeholder="ì˜ˆ: ë°ì¼ë¦¬ ë‹ˆíŠ¸">
                        </div>
                        <div>
                            <label
                                class="text-xs font-medium text-text-light/60 dark:text-text-dark/60 mb-1 block">ì¹´í…Œê³ ë¦¬</label>
                            <select id="input-category"
                                class="w-full px-4 py-3 bg-white dark:bg-card-dark border border-border-light dark:border-border-dark rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="ìƒì˜">ìƒì˜</option>
                                <option value="í•˜ì˜">í•˜ì˜</option>
                                <option value="ì•„ìš°í„°">ì•„ìš°í„°</option>
                                <option value="ì›í”¼ìŠ¤">ì›í”¼ìŠ¤</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                            </select>
                        </div>
                        <div>
                            <label
                                class="text-xs font-medium text-text-light/60 dark:text-text-dark/60 mb-1 block">ìƒ‰ìƒ</label>
                            <input type="text" id="input-color"
                                class="w-full px-4 py-3 bg-white dark:bg-card-dark border border-border-light dark:border-border-dark rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                placeholder="ì˜ˆ: ë¸”ë™">
                        </div>
                        <div>
                            <label
                                class="text-xs font-medium text-text-light/60 dark:text-text-dark/60 mb-1 block">ì‚¬ì´ì¦ˆ</label>
                            <select id="input-size"
                                class="w-full px-4 py-3 bg-white dark:bg-card-dark border border-border-light dark:border-border-dark rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="">ì„ íƒ ì•ˆí•¨</option>
                                <option value="XS">XS (85)</option>
                                <option value="S">S (90)</option>
                                <option value="M">M (95)</option>
                                <option value="L">L (100)</option>
                                <option value="XL">XL (105)</option>
                                <option value="XXL">XXL (110)</option>
                                <option value="FREE">FREE</option>
                            </select>
                        </div>
                        <div>
                            <label
                                class="text-xs font-medium text-text-light/60 dark:text-text-dark/60 mb-1 block">ì‹œì¦Œ</label>
                            <select id="input-season"
                                class="w-full px-4 py-3 bg-white dark:bg-card-dark border border-border-light dark:border-border-dark rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="ì‚¬ê³„ì ˆ">ì‚¬ê³„ì ˆ</option>
                                <option value="ë´„/ê°€ì„">ë´„/ê°€ì„</option>
                                <option value="ì—¬ë¦„">ì—¬ë¦„</option>
                                <option value="ê²¨ìš¸">ê²¨ìš¸</option>
                            </select>
                        </div>
                        <div>
                            <label
                                class="text-xs font-medium text-text-light/60 dark:text-text-dark/60 mb-1 block">ìŠ¤íƒ€ì¼</label>
                            <select id="input-style"
                                class="w-full px-4 py-3 bg-white dark:bg-card-dark border border-border-light dark:border-border-dark rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="ìºì£¼ì–¼">ìºì£¼ì–¼</option>
                                <option value="í¬ë©€">í¬ë©€</option>
                                <option value="ìŠ¤í¬ì¸ ">ìŠ¤í¬ì¸ </option>
                                <option value="ìŠ¤íŠ¸ë¦¿">ìŠ¤íŠ¸ë¦¿</option>
                                <option value="ë¯¸ë‹ˆë©€">ë¯¸ë‹ˆë©€</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="text-xs font-medium text-text-light/60 dark:text-text-dark/60 mb-2 block">ì„ í˜¸ë„
                                (ë³„ì )</label>
                            <div id="rating-input" class="flex items-center gap-1">
                                <span
                                    class="rating-star material-symbols-outlined text-3xl text-gray-300 cursor-pointer hover:text-yellow-400 transition-colors"
                                    data-value="1">star</span>
                                <span
                                    class="rating-star material-symbols-outlined text-3xl text-gray-300 cursor-pointer hover:text-yellow-400 transition-colors"
                                    data-value="2">star</span>
                                <span
                                    class="rating-star material-symbols-outlined text-3xl text-gray-300 cursor-pointer hover:text-yellow-400 transition-colors"
                                    data-value="3">star</span>
                                <span
                                    class="rating-star material-symbols-outlined text-3xl text-gray-300 cursor-pointer hover:text-yellow-400 transition-colors"
                                    data-value="4">star</span>
                                <span
                                    class="rating-star material-symbols-outlined text-3xl text-gray-300 cursor-pointer hover:text-yellow-400 transition-colors"
                                    data-value="5">star</span>
                                <span id="rating-text" class="ml-3 text-sm text-text-light/50 dark:text-text-dark/50">í´ë¦­í•˜ì—¬ ì„ í˜¸ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
                            </div>
                            <input type="hidden" id="input-rating" value="">
                        </div>
                    </div>

                    <!-- C/D ë“±ê¸‰ ê²½ê³  ë°°ë„ˆ (ìˆ¨ê¹€ ìƒíƒœ, JSë¡œ í‘œì‹œ) -->
                    <div id="grade-warning-section" class="hidden space-y-4">
                        <!-- ê²½ê³  ë°°ë„ˆ -->
                        <div
                            class="bg-gradient-to-r from-orange-500/10 to-red-500/10 border border-orange-500/30 rounded-xl p-4">
                            <div class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-2xl text-orange-500">warning</span>
                                <div>
                                    <h4 class="font-bold text-orange-600 dark:text-orange-400">ìƒíƒœê°€ ì¢‹ì§€ ì•Šì€ ì˜ë¥˜ì…ë‹ˆë‹¤</h4>
                                    <p class="text-sm text-text-light/70 dark:text-text-dark/70 mt-1">
                                        ìˆ˜ì„ ì´ ì–´ë ¤ìš´ ìƒíƒœì˜ˆìš”. ì—…ì‚¬ì´í´ë§ì´ë‚˜ íê¸° ìˆ˜ê±° ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ë³´ì„¸ìš”.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- ì—…ì‚¬ì´í´ë§ ë ˆì‹œí”¼ (Pinterest ìŠ¤íƒ€ì¼) -->
                        <div
                            class="bg-gradient-to-br from-emerald-500/5 to-teal-500/5 border border-emerald-500/20 rounded-2xl p-5">
                            <h4 class="font-bold text-emerald-600 dark:text-emerald-400 flex items-center gap-2 mb-4">
                                <span class="material-symbols-outlined">recycling</span>
                                ì´ ì˜·ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”!
                            </h4>
                            <div id="upcycling-recipes" class="grid grid-cols-2 gap-3">
                                <!-- JavaScriptë¡œ ì¹´í…Œê³ ë¦¬ë³„ ë ˆì‹œí”¼ ì¹´ë“œ ì±„ì›€ -->
                            </div>
                            <p class="text-xs text-text-light/50 dark:text-text-dark/50 mt-3 text-center">
                                ğŸ¬ í´ë¦­í•˜ë©´ ìœ íŠœë¸Œ íŠœí† ë¦¬ì–¼ë¡œ ì´ë™í•´ìš”
                            </p>
                        </div>

                        <!-- íê¸° ì„œë¹„ìŠ¤ ë§í¬ -->
                        <a href="/analysis/disposal"
                            class="block w-full py-4 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold rounded-xl shadow-lg transition-all hover:scale-[1.02] text-center">
                            <span class="material-symbols-outlined align-middle mr-1">local_shipping</span>
                            íê¸° ìˆ˜ê±° ì„œë¹„ìŠ¤ ì•Œì•„ë³´ê¸°
                        </a>
                    </div>

                    <!-- ì˜·ì¥ ë“±ë¡ ë²„íŠ¼ (A/B ë“±ê¸‰ìš©) -->
                    <button id="register-btn"
                        class="w-full py-4 bg-primary hover:bg-primary/90 text-white font-bold rounded-xl shadow-lg shadow-primary/30 transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined">add_circle</span>
                        ì˜·ì¥ì— ì¶”ê°€í•˜ê¸°
                    </button>
                </div>

            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer th:replace="~{fragments/footer :: footerFragment}"></footer>

    <script>
        // ===== ìƒíƒœ ë³€ìˆ˜ =====
        let analysisResult = null;
        let processedImageBase64 = null;

        // ===== Elements =====
        const clothingInput = document.getElementById('clothing-input');
        const labelInput = document.getElementById('label-input');
        const analyzeBtn = document.getElementById('analyze-btn');

        // ===== íŒŒì¼ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬ =====
        function setupUpload(dropZoneId, inputId, placeholderId, previewId, imgId, removeBtnId) {
            const dropZone = document.getElementById(dropZoneId);
            const input = document.getElementById(inputId);
            const placeholder = document.getElementById(placeholderId);
            const preview = document.getElementById(previewId);
            const img = document.getElementById(imgId);
            const removeBtn = document.getElementById(removeBtnId);

            dropZone.addEventListener('click', () => input.click());

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('border-primary', 'bg-primary/5');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('border-primary', 'bg-primary/5');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-primary', 'bg-primary/5');
                if (e.dataTransfer.files[0]) {
                    input.files = e.dataTransfer.files;
                    showPreview(input.files[0]);
                }
            });

            input.addEventListener('change', (e) => {
                if (e.target.files[0]) showPreview(e.target.files[0]);
            });

            function showPreview(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    img.src = e.target.result;
                    placeholder.classList.add('hidden');
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }

            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                input.value = '';
                placeholder.classList.remove('hidden');
                preview.classList.add('hidden');
            });
        }

        setupUpload('clothing-drop-zone', 'clothing-input', 'clothing-placeholder', 'clothing-preview', 'clothing-img', 'clothing-remove');
        setupUpload('label-drop-zone', 'label-input', 'label-placeholder', 'label-preview', 'label-img', 'label-remove');

        // ===== ì—…ì‚¬ì´í´ë§ ë ˆì‹œí”¼ ë°ì´í„° =====
        const upcyclingRecipes = {
            'ìƒì˜': [
                { name: 'ì—ì½”ë°± ë§Œë“¤ê¸°', time: '15ë¶„', level: 'ì‰¬ì›€', icon: 'ğŸ›ï¸', youtube: 'https://www.youtube.com/results?search_query=í‹°ì…”ì¸ +ì—ì½”ë°±+ë§Œë“¤ê¸°' },
                { name: 'ì¿ ì…˜ ì»¤ë²„', time: '20ë¶„', level: 'ë³´í†µ', icon: 'ğŸ›‹ï¸', youtube: 'https://www.youtube.com/results?search_query=í‹°ì…”ì¸ +ì¿ ì…˜ì»¤ë²„+DIY' },
                { name: 'í—¤ì–´ë°´ë“œ', time: '10ë¶„', level: 'ì‰¬ì›€', icon: 'ğŸ€', youtube: 'https://www.youtube.com/results?search_query=í‹°ì…”ì¸ +í—¤ì–´ë°´ë“œ+ë§Œë“¤ê¸°' },
                { name: 'ê±¸ë ˆ/í–‰ì£¼', time: '5ë¶„', level: 'ì‰¬ì›€', icon: 'ğŸ§¹', youtube: 'https://www.youtube.com/results?search_query=í—Œì˜·+ê±¸ë ˆ+ë§Œë“¤ê¸°' }
            ],
            'í•˜ì˜': [
                { name: 'í† íŠ¸ë°±', time: '30ë¶„', level: 'ë³´í†µ', icon: 'ğŸ‘œ', youtube: 'https://www.youtube.com/results?search_query=ì²­ë°”ì§€+í† íŠ¸ë°±+ë§Œë“¤ê¸°' },
                { name: 'ì•ì¹˜ë§ˆ', time: '25ë¶„', level: 'ë³´í†µ', icon: 'ğŸ‘¨â€ğŸ³', youtube: 'https://www.youtube.com/results?search_query=ì²­ë°”ì§€+ì•ì¹˜ë§ˆ+DIY' },
                { name: 'í•„í†µ/íŒŒìš°ì¹˜', time: '20ë¶„', level: 'ì‰¬ì›€', icon: 'âœï¸', youtube: 'https://www.youtube.com/results?search_query=ì²­ë°”ì§€+íŒŒìš°ì¹˜+ë§Œë“¤ê¸°' },
                { name: 'ì»µí™€ë”', time: '15ë¶„', level: 'ì‰¬ì›€', icon: 'â˜•', youtube: 'https://www.youtube.com/results?search_query=ì²­ë°”ì§€+ì»µí™€ë”+DIY' }
            ],
            'ì•„ìš°í„°': [
                { name: 'ì¿ ì…˜/ë°©ì„', time: '30ë¶„', level: 'ë³´í†µ', icon: 'ğŸª‘', youtube: 'https://www.youtube.com/results?search_query=íŒ¨ë”©+ì¿ ì…˜+ë§Œë“¤ê¸°' },
                { name: 'ë‹´ìš”(ì•ˆê°)', time: '40ë¶„', level: 'ì–´ë ¤ì›€', icon: 'ğŸ›ï¸', youtube: 'https://www.youtube.com/results?search_query=ì½”íŠ¸+ë‹´ìš”+ë¦¬í¼' },
                { name: 'ë°˜ë ¤ë™ë¬¼ ì¹¨ëŒ€', time: '35ë¶„', level: 'ë³´í†µ', icon: 'ğŸ•', youtube: 'https://www.youtube.com/results?search_query=í—Œì˜·+ê°•ì•„ì§€ì¹¨ëŒ€+ë§Œë“¤ê¸°' },
                { name: 'ê°€ë°© ì•ˆê°', time: '25ë¶„', level: 'ë³´í†µ', icon: 'ğŸ‘', youtube: 'https://www.youtube.com/results?search_query=ì˜·+ê°€ë°©ì•ˆê°+ë¦¬í¼' }
            ],
            'ì›í”¼ìŠ¤': [
                { name: 'ì•ì¹˜ë§ˆ', time: '20ë¶„', level: 'ì‰¬ì›€', icon: 'ğŸ‘¨â€ğŸ³', youtube: 'https://www.youtube.com/results?search_query=ì›í”¼ìŠ¤+ì•ì¹˜ë§ˆ+ë¦¬í¼' },
                { name: 'ìŠ¤ì¹´í”„', time: '15ë¶„', level: 'ì‰¬ì›€', icon: 'ğŸ§£', youtube: 'https://www.youtube.com/results?search_query=ì›í”¼ìŠ¤+ìŠ¤ì¹´í”„+ë§Œë“¤ê¸°' },
                { name: 'íŒŒìš°ì¹˜', time: '20ë¶„', level: 'ì‰¬ì›€', icon: 'ğŸ‘›', youtube: 'https://www.youtube.com/results?search_query=ì›ë‹¨+íŒŒìš°ì¹˜+DIY' },
                { name: 'ë¨¸ë¦¬ëˆ', time: '10ë¶„', level: 'ì‰¬ì›€', icon: 'ğŸ’‡', youtube: 'https://www.youtube.com/results?search_query=ì²œ+ë¨¸ë¦¬ëˆ+ë§Œë“¤ê¸°' }
            ]
        };

        // ì—…ì‚¬ì´í´ë§ ë ˆì‹œí”¼ ì¹´ë“œ ìƒì„±
        function showUpcyclingRecipes(category) {
            const container = document.getElementById('upcycling-recipes');
            // ì¹´í…Œê³ ë¦¬ ë§¤í•‘ (í•œê¸€/ì˜ì–´ ë³€í™˜)
            let key = 'ìƒì˜';
            if (category.includes('ìƒì˜') || category.includes('Top') || category.includes('í‹°ì…”ì¸ ')) key = 'ìƒì˜';
            else if (category.includes('í•˜ì˜') || category.includes('Bottom') || category.includes('ë°”ì§€')) key = 'í•˜ì˜';
            else if (category.includes('ì•„ìš°í„°') || category.includes('Outer') || category.includes('ì½”íŠ¸') || category.includes('ìì¼“')) key = 'ì•„ìš°í„°';
            else if (category.includes('ì›í”¼ìŠ¤') || category.includes('Dress')) key = 'ì›í”¼ìŠ¤';

            const recipes = upcyclingRecipes[key] || upcyclingRecipes['ìƒì˜'];

            container.innerHTML = recipes.map(r => `
                <a href="${r.youtube}" target="_blank" 
                   class="group bg-white dark:bg-card-dark rounded-xl p-3 border border-gray-100 dark:border-gray-700 hover:border-emerald-400 hover:shadow-lg hover:scale-[1.02] transition-all cursor-pointer">
                    <div class="flex items-start gap-3">
                        <span class="text-2xl">${r.icon}</span>
                        <div class="flex-1 min-w-0">
                            <p class="font-medium text-sm text-gray-800 dark:text-gray-200 group-hover:text-emerald-600 truncate">${r.name}</p>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-xs text-gray-400">â±ï¸ ${r.time}</span>
                                <span class="text-xs px-1.5 py-0.5 rounded ${r.level === 'ì‰¬ì›€' ? 'bg-green-100 text-green-600' : r.level === 'ë³´í†µ' ? 'bg-yellow-100 text-yellow-600' : 'bg-red-100 text-red-600'}">${r.level}</span>
                            </div>
                        </div>
                        <span class="material-symbols-outlined text-gray-300 group-hover:text-red-500 text-lg">play_circle</span>
                    </div>
                </a>
            `).join('');
        }


        // ===== ì‚¬ì´ì¦ˆ ì§ì ‘ ì…ë ¥ í† ê¸€ =====
        function toggleCustomSize() {
            const sizeSelect = document.getElementById('input-size');
            const customInput = document.getElementById('input-size-custom');
            if (sizeSelect.value === 'CUSTOM') {
                customInput.classList.remove('hidden');
                customInput.focus();
            } else {
                customInput.classList.add('hidden');
                customInput.value = '';
            }
        }
        window.toggleCustomSize = toggleCustomSize; // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡

        // ì‚¬ì´ì¦ˆ ê°’ ê°€ì ¸ì˜¤ê¸° (ë“œë¡­ë‹¤ìš´ ë˜ëŠ” ì§ì ‘ ì…ë ¥)
        function getSizeValue() {
            const sizeSelect = document.getElementById('input-size');
            const customInput = document.getElementById('input-size-custom');
            if (sizeSelect.value === 'CUSTOM') {
                // ì§ì ‘ ì…ë ¥ê°’ ê²€ì¦ (10ì ì´í•˜, íŠ¹ìˆ˜ë¬¸ì ì œê±°)
                let customValue = customInput.value.trim().substring(0, 10);
                customValue = customValue.replace(/[^a-zA-Z0-9ê°€-í£]/g, '');
                return customValue || null;
            }
            return sizeSelect.value || null;
        }
        window.getSizeValue = getSizeValue;


        // ===== ë³„ì  ì„ íƒ í•¸ë“¤ëŸ¬ =====
        const ratingStars = document.querySelectorAll('.rating-star');
        const ratingInput = document.getElementById('input-rating');
        const ratingText = document.getElementById('rating-text');
        let currentRating = 0;

        ratingStars.forEach(star => {
            star.addEventListener('click', () => {
                currentRating = parseInt(star.dataset.value);
                ratingInput.value = currentRating;
                updateStars(currentRating);
                ratingText.textContent = `${currentRating}ì  ì„ íƒë¨`;
                ratingText.classList.remove('text-text-light/50');
                ratingText.classList.add('text-yellow-500', 'font-medium');
            });
        });

        function updateStars(rating) {
            ratingStars.forEach(star => {
                const value = parseInt(star.dataset.value);
                if (value <= rating) {
                    star.classList.remove('text-gray-300');
                    star.classList.add('text-yellow-400');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-300');
                }
            });
        }

        // ===== ë¶„ì„ ì‹œì‘ =====
        analyzeBtn.addEventListener('click', async () => {
            if (!clothingInput.files[0]) {
                alert('ì˜ë¥˜ ì‚¬ì§„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // UI ìƒíƒœ ë³€ê²½
            document.getElementById('upload-section').classList.add('hidden');
            document.getElementById('loading-section').classList.remove('hidden');
            document.getElementById('result-section').classList.add('hidden');

            const formData = new FormData();
            formData.append('clothingImage', clothingInput.files[0]);
            if (labelInput.files[0]) {
                formData.append('labelImage', labelInput.files[0]);
            }

            try {
                const response = await fetch('http://192.168.0.2:5000/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                console.log('ë¶„ì„ ê²°ê³¼:', data);

                if (data.success) {
                    displayResults(data);
                } else {
                    alert('ë¶„ì„ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    resetUI();
                }
            } catch (error) {
                console.error('Error:', error);
                alert('ì„œë²„ ì—°ê²° ì˜¤ë¥˜. yolo_analysis ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
                resetUI();
            }
        });

        function resetUI() {
            document.getElementById('upload-section').classList.remove('hidden');
            document.getElementById('loading-section').classList.add('hidden');
        }

        // ===== ê²°ê³¼ í‘œì‹œ =====
        function displayResults(data) {
            analysisResult = data;
            processedImageBase64 = data.clothing_image_no_bg_base64;

            document.getElementById('loading-section').classList.add('hidden');
            document.getElementById('result-section').classList.remove('hidden');

            // ë“±ê¸‰ í‘œì‹œ
            if (data.condition_analysis) {
                const cond = data.condition_analysis;
                const badge = document.getElementById('grade-badge');
                const gradeChar = cond.grade.charAt(0);
                badge.textContent = gradeChar;

                // ë“±ê¸‰ë³„ ìƒ‰ìƒ
                badge.className = 'inline-flex items-center justify-center size-24 rounded-full text-4xl font-black text-white shadow-xl mb-3 ';
                if (gradeChar === 'S') badge.classList.add('bg-gradient-to-br', 'from-emerald-400', 'to-green-600');
                else if (gradeChar === 'A') badge.classList.add('bg-gradient-to-br', 'from-blue-400', 'to-indigo-600');
                else badge.classList.add('bg-gradient-to-br', 'from-orange-400', 'to-red-600');

                document.getElementById('grade-score').textContent = cond.score + 'ì ';
                document.getElementById('grade-recommendation').textContent = cond.recommendation;

                // ê²°í•¨ ë¶„ì„ ì´ë¯¸ì§€
                if (cond.annotated_image_base64) {
                    document.getElementById('defect-img').src = 'data:image/jpeg;base64,' + cond.annotated_image_base64;
                }

                // ê²°í•¨ ëª©ë¡
                const defectList = document.getElementById('defect-list');
                defectList.innerHTML = '';
                if (cond.defects && cond.defects.length > 0) {
                    cond.defects.forEach(d => {
                        const name = d.type.includes('(') ? d.type.split('(')[1].replace(')', '') : d.type;
                        defectList.innerHTML += `<li class="flex items-center gap-2 text-sm"><span class="size-2 bg-red-500 rounded-full"></span>${name}</li>`;
                    });
                } else {
                    defectList.innerHTML = '<li class="text-green-500 flex items-center gap-2"><span class="material-symbols-outlined">check_circle</span>ê²°í•¨ ì—†ìŒ</li>';
                }

                // Bë“±ê¸‰ ì²˜ë¦¬ (ê²½ê³  í‘œì‹œ + ì—…ì‚¬ì´í´ë§ ë ˆì‹œí”¼)
                const isLowGrade = gradeChar === 'B';
                const warningSection = document.getElementById('grade-warning-section');
                const registerBtn = document.getElementById('register-btn');

                if (isLowGrade) {
                    warningSection.classList.remove('hidden');
                    registerBtn.classList.add('hidden');

                    // ì¹´í…Œê³ ë¦¬ë³„ ì—…ì‚¬ì´í´ë§ ë ˆì‹œí”¼ í‘œì‹œ
                    const category = analysisResult?.clothing_analysis?.category || 'ìƒì˜';
                    showUpcyclingRecipes(category);
                } else {
                    warningSection.classList.add('hidden');
                    registerBtn.classList.remove('hidden');
                }
            }

            // ë°°ê²½ ì œê±° ì´ë¯¸ì§€
            if (data.clothing_image_no_bg_base64) {
                document.getElementById('nobg-img').src = 'data:image/png;base64,' + data.clothing_image_no_bg_base64;
            }

            // K-Fashion ìŠ¤íƒ€ì¼
            if (data.clothing_analysis) {
                const info = data.clothing_analysis;
                const styleTags = document.getElementById('style-tags');
                styleTags.innerHTML = '';

                const tags = [
                    { label: info.style, color: 'bg-purple-100 text-purple-700' },
                    { label: info.sub_style, color: 'bg-pink-100 text-pink-700' },
                    { label: info.category, color: 'bg-blue-100 text-blue-700' },
                    { label: info.sub_category, color: 'bg-indigo-100 text-indigo-700' }
                ];

                tags.forEach(t => {
                    if (t.label && t.label !== 'null') {
                        styleTags.innerHTML += `<span class="px-3 py-1 ${t.color} rounded-full text-sm font-medium">${t.label}</span>`;
                    }
                });

                // ì„¸ë¶€ ì†ì„±
                const attrs = document.getElementById('attributes-grid');
                attrs.innerHTML = '';
                const attrList = [
                    { label: 'ì»¬ëŸ¬', value: info.color },
                    { label: 'ì†Œì¬', value: info.material },
                    { label: 'í•', value: info.fit },
                    { label: 'ê¸°ì¥', value: info.length },
                    { label: 'ë„¥ë¼ì¸', value: info.neckline },
                    { label: 'ì†Œë§¤', value: info.sleeve_length },
                    { label: 'í”„ë¦°íŠ¸', value: info.print },
                    { label: 'ì‹œì¦Œ', value: info.season }
                ];

                attrList.forEach(a => {
                    if (a.value && a.value !== 'null' && a.value !== null) {
                        attrs.innerHTML += `
                            <div class="p-3 bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark">
                                <p class="text-xs text-text-light/50 dark:text-text-dark/50 mb-1">${a.label}</p>
                                <p class="font-medium">${a.value}</p>
                            </div>
                        `;
                    }
                });

                // ì…ë ¥ í•„ë“œ ìë™ ì±„ìš°ê¸°
                document.getElementById('input-name').value = info.short_name || (info.color + ' ' + (info.sub_category || info.category)) || '';
                if (info.category) document.getElementById('input-category').value = info.category;
                document.getElementById('input-color').value = info.color || '';
                if (info.season) {
                    const seasonSel = document.getElementById('input-season');
                    const options = Array.from(seasonSel.options);
                    const match = options.find(o => info.season.includes(o.value) || o.value.includes(info.season));
                    if (match) seasonSel.value = match.value;
                }
                if (info.style) document.getElementById('input-style').value = info.style;
            }

            // ì¼€ì–´ë¼ë²¨ ì •ë³´
            if (data.tag_analysis && !data.tag_analysis.error) {
                const tag = data.tag_analysis;
                document.getElementById('tag-info').innerHTML = `
                    <p><span class="text-text-light/50 dark:text-text-dark/50">ì†Œì¬:</span> ${tag.material || '-'}</p>
                    <p><span class="text-text-light/50 dark:text-text-dark/50">ì‚¬ì´ì¦ˆ:</span> ${tag.size || '-'}</p>
                    <p><span class="text-text-light/50 dark:text-text-dark/50">ë¸Œëœë“œ:</span> ${tag.brand || '-'}</p>
                    <p><span class="text-text-light/50 dark:text-text-dark/50">ì„¸íƒ:</span> ${tag.washing_instruction || '-'}</p>
                `;
                if (tag.size) {
                    // íƒœê·¸ ì‚¬ì´ì¦ˆë¥¼ ë“œë¡­ë‹¤ìš´ ì˜µì…˜ê³¼ ë§¤ì¹­
                    const sizeSelect = document.getElementById('input-size');
                    const sizeMap = {
                        'XS': 'XS', 'S': 'S', 'M': 'M', 'L': 'L', 'XL': 'XL', 'XXL': 'XXL', 'FREE': 'FREE',
                        '85': 'XS', '90': 'S', '95': 'M', '100': 'L', '105': 'XL', '110': 'XXL'
                    };
                    const normalizedSize = tag.size.toUpperCase().trim();
                    sizeSelect.value = sizeMap[normalizedSize] || '';
                }
            }

            // ìŠ¤í¬ë¡¤
            document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
        }

        // ===== ì˜·ì¥ ë“±ë¡ =====
        document.getElementById('register-btn').addEventListener('click', async () => {
            const name = document.getElementById('input-name').value.trim();
            if (!name) {
                alert('ì˜ë¥˜ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const btn = document.getElementById('register-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="material-symbols-outlined animate-spin">sync</span> ë“±ë¡ ì¤‘...';

            try {
                const requestData = {
                    name: name,
                    category: document.getElementById('input-category').value,
                    color: document.getElementById('input-color').value || null,
                    style: document.getElementById('input-style').value,
                    season: document.getElementById('input-season').value,
                    itemSize: document.getElementById('input-size').value || null,
                    conditionGrade: analysisResult?.condition_analysis?.grade || 'Aë“±ê¸‰',
                    detailDesc: analysisResult?.clothing_analysis?.description || '',
                    imageBase64: processedImageBase64 ? ('data:image/png;base64,' + processedImageBase64) : null,
                    personalNote: document.getElementById('input-rating').value || null,
                    material: analysisResult?.tag_info?.material || analysisResult?.clothing_analysis?.material || null,
                    materialPercentage: 100
                };

                const response = await fetch('/api/wardrobe/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();

                if (result.success) {
                    alert('âœ… ì˜·ì¥ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    window.location.href = '/wardrobe';
                } else {
                    alert('ë“±ë¡ ì‹¤íŒ¨: ' + result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('ì„œë²„ ì˜¤ë¥˜: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span class="material-symbols-outlined">add_circle</span> ì˜·ì¥ì— ì¶”ê°€í•˜ê¸°';
            }
        });
    </script>
</body>

</html>