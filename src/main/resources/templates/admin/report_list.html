<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <div th:replace="fragments/head :: head"></div>
    <title>Ïã†Í≥† Í¥ÄÎ¶¨ - Re:birth Admin</title>
</head>

<body class="bg-gray-100 font-sans leading-normal tracking-normal">

    <!-- Header -->
    <div th:replace="fragments/header :: header"></div>

    <div class="container mx-auto mt-20 px-4">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">üö® Ïã†Í≥† Ï†ëÏàò Î™©Î°ù</h1>

        <div class="bg-white shadow-md rounded my-6 overflow-x-auto">
            <table class="min-w-full table-auto">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">ID</th>
                        <th class="py-3 px-6 text-left">Ïã†Í≥†Ïûê</th>
                        <th class="py-3 px-6 text-left">ÌîºÏã†Í≥†Ïûê</th>
                        <th class="py-3 px-6 text-left">ÏÇ¨Ïú†</th>
                        <th class="py-3 px-6 text-left">ÎÇ¥Ïö©</th>
                        <th class="py-3 px-6 text-center">ÏÉÅÌÉú</th>
                        <th class="py-3 px-6 text-center">Ï°∞Ïπò</th>
                    </tr>
                </thead>
                <tbody class="text-gray-600 text-sm font-light">
                    <tr th:each="report : ${reportList}" class="border-b border-gray-200 hover:bg-gray-100">
                        <td class="py-3 px-6 text-left whitespace-nowrap">
                            <span class="font-medium" th:text="${report.id}">1</span>
                        </td>
                        <td class="py-3 px-6 text-left">
                            <span th:text="${report.reporterName != null ? report.reporterName : 'Unknown'}">User
                                A</span>
                        </td>
                        <td class="py-3 px-6 text-left">
                            <span class="font-bold text-red-500"
                                th:text="${report.reportedUserName != null ? report.reportedUserName : 'Unknown'}">Bad
                                User</span>
                        </td>
                        <td class="py-3 px-6 text-left">
                            <span class="bg-blue-200 text-blue-600 py-1 px-3 rounded-full text-xs"
                                th:text="${report.reasonCategory}">SPAM</span>
                        </td>
                        <td class="py-3 px-6 text-left">
                            <span th:text="${report.description}">Ïã†Í≥† ÎÇ¥Ïö©ÏûÖÎãàÎã§.</span>
                        </td>
                        <td class="py-3 px-6 text-center">
                            <span th:if="${report.isProcessed == 'Y'}"
                                class="bg-green-200 text-green-600 py-1 px-3 rounded-full text-xs">Ï≤òÎ¶¨ÏôÑÎ£å</span>
                            <span th:unless="${report.isProcessed == 'Y'}"
                                class="bg-yellow-200 text-yellow-600 py-1 px-3 rounded-full text-xs">ÎåÄÍ∏∞Ï§ë</span>
                        </td>
                        <td class="py-3 px-6 text-center">
                            <button th:if="${report.isProcessed != 'Y'}"
                                th:onclick="'processReport(' + ${report.id} + ', ' + ${report.reportedUserId} + ')'"
                                class="bg-red-500 text-white py-1 px-3 rounded hover:bg-red-600 transition text-xs">
                                Ï†úÏû¨ÌïòÍ∏∞
                            </button>
                            <span th:if="${report.isProcessed == 'Y'}" class="text-gray-400 text-xs">-</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer -->
    <div th:replace="fragments/footer :: footer"></div>

    <script th:inline="javascript">
        function processReport(reportId, targetUserId) {
            const actionType = prompt("Ï†úÏû¨ Ï¢ÖÎ•òÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (WARNING / SUSPENSION / BAN):", "WARNING");
            if (!actionType) return;

            const reason = prompt("Ï†úÏû¨ ÏÇ¨Ïú†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:", "Ïª§ÎÆ§ÎãàÌã∞ Í∞ÄÏù¥ÎìúÎùºÏù∏ ÏúÑÎ∞ò");
            if (!reason) return;

            const data = {
                reportId: reportId,
                targetUserId: targetUserId,
                actionType: actionType,
                actionReason: reason
            };

            fetch('/admin/report/action', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(data.message);
                        location.reload();
                    } else {
                        alert("Ï≤òÎ¶¨ Ïã§Ìå®: " + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert("Ïò§Î•ò Î∞úÏÉù");
                });
        }
    </script>
</body>

</html>