<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: headFragment}"></head>

<body
    class="font-display bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark min-h-screen flex flex-col">
    <!-- Header -->
    <header th:replace="~{fragments/header :: headerFragment}"></header>

    <!-- Main Content -->
    <main class="flex-grow pt-60 px-4 pb-12">
        <div class="max-w-4xl mx-auto w-full">

            <!-- Title & Tabs -->
            <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                <div class="w-full md:w-auto">
                    <h1 class="text-3xl font-bold mb-6">Î¨∏Ïùò Î∞è Í≥µÏßÄÏÇ¨Ìï≠</h1>

                    <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÉ≠: NOTICE / QNA -->
                    <div
                        class="flex p-1 bg-card-light dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark inline-flex">
                        <!-- Í≥µÏßÄÏÇ¨Ìï≠ ÌÉ≠ -->
                        <a th:href="@{/community(category='NOTICE', page=${page != null ? page.number : 0}, keyword=${keyword})}"
                            class="px-6 py-2 rounded-lg font-bold text-sm transition-all"
                            th:classappend="${currentCategory} == 'NOTICE' ?
                             ' bg-primary text-white shadow-sm' :
                             ' text-text-light/60 dark:text-text-dark/60 hover:text-text-light hover:bg-background-light dark:hover:bg-background-dark'">
                            Í≥µÏßÄÏÇ¨Ìï≠
                        </a>

                        <!-- Î¨∏ÏùòÌïòÍ∏∞ ÌÉ≠ -->
                        <a th:href="@{/community(category='QNA', page=${page != null ? page.number : 0}, keyword=${keyword})}"
                            class="px-6 py-2 rounded-lg font-bold text-sm transition-all"
                            th:classappend="${currentCategory} == 'QNA' ?
                             ' bg-primary text-white shadow-sm' :
                             ' text-text-light/60 hover:text-text-light hover:bg-background-light dark:hover:bg-background-dark'">
                            Î¨∏ÏùòÌïòÍ∏∞
                        </a>
                    </div>
                </div>

                <!-- Ïö∞Ï∏° Î≤ÑÌäº ÏòÅÏó≠ -->
                <div class="flex gap-2 w-full md:w-auto justify-end">
                    <!-- Í¥ÄÎ¶¨ÏûêÎßå Î≥¥Ïù¥Îäî Í∏ÄÏì∞Í∏∞ Î≤ÑÌäº (Í≥µÏßÄÏÇ¨Ìï≠ ÌÉ≠Ïùº ÎïåÎßå) -->
                    <a th:if="${isAdmin} and ${currentCategory == 'NOTICE'}"
                        th:href="@{/community/new(category='NOTICE')}"
                        class="px-4 py-2 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-xl font-bold text-sm hover:border-primary/50 transition-colors flex items-center gap-2">
                        <span class="material-symbols-outlined text-lg">edit</span>
                        <span class="hidden sm:inline">Í∏ÄÏì∞Í∏∞ (Í¥ÄÎ¶¨Ïûê)</span>
                    </a>

                    <!-- Î¨∏ÏùòÌïòÍ∏∞ Î≤ÑÌäº: QNA Í∏ÄÏì∞Í∏∞ Î∞îÎ°ú Ïù¥Îèô -->
                    <a th:href="@{/community/new(category='QNA')}"
                        class="px-4 py-2 bg-primary text-white rounded-xl font-bold text-sm hover:bg-primary/90 transition-colors shadow-lg shadow-primary/30 flex items-center gap-2">
                        <span class="material-symbols-outlined text-lg">support_agent</span>
                        <span class="hidden sm:inline">Î¨∏ÏùòÌïòÍ∏∞</span>
                    </a>
                </div>
            </div>

            <!-- Search Bar -->
            <form th:action="@{/community}" method="get" class="relative mb-8">
                <input type="hidden" name="category" th:value="${currentCategory}">
                <span
                    class="absolute left-4 top-1/2 -translate-y-1/2 material-symbols-outlined text-text-light/50 dark:text-text-dark/50">search</span>
                <input type="text" name="keyword" placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" th:value="${keyword}"
                    class="w-full h-12 pl-12 pr-4 rounded-xl bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark focus:ring-2 focus:ring-primary/50 outline-none transition-shadow">
            </form>

            <!-- Notice / Post List -->
            <div class="flex flex-col gap-4">

                <!-- Í≤åÏãúÍ∏ÄÏù¥ ÌïòÎÇòÎèÑ ÏóÜÎäî Í≤ΩÏö∞ -->
                <div th:if="${#lists.isEmpty(posts)}"
                    class="p-6 bg-card-light dark:bg-card-dark rounded-2xl border border-dashed border-border-light/70 dark:border-border-dark/70 text-center text-sm text-text-light/60 dark:text-text-dark/60">
                    Îì±Î°ùÎêú Í≤åÏãúÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.
                </div>

                <!-- ÏùºÎ∞ò Í≤åÏãúÍ∏Ä Î™©Î°ù -->
                <a th:each="post : ${posts}" th:href="@{/community/{id}(id=${post.id})}"
                    class="p-6 bg-card-light dark:bg-card-dark rounded-2xl border border-border-light dark:border-border-dark hover:border-primary/30 transition-colors cursor-pointer block">
                    <div class="flex items-start justify-between gap-4">
                        <div>
                            <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ Î±ÉÏßÄ -->
                            <span
                                class="inline-block px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-800 text-text-light/60 dark:text-text-dark/60 text-xs font-bold mb-2"
                                th:text="${post.category == 'NOTICE' ? 'Í≥µÏßÄÏÇ¨Ìï≠' :
                                          (post.category == 'QNA' ? 'Î¨∏ÏùòÌïòÍ∏∞' : post.category)}">
                                ÏóÖÎç∞Ïù¥Ìä∏
                            </span>
                            <span th:if="${post.answer != null}"
                                class="inline-block ml-1 px-1.5 py-0.5 rounded bg-primary/10 text-primary text-xs font-bold mb-2">ÎãµÎ≥ÄÏôÑÎ£å</span>

                            <!-- Ï†úÎ™© (ÎπÑÎ∞ÄÍ∏ÄÏù¥Î©¥ üîí ÌëúÏãú) -->
                            <h3 class="text-lg font-bold mb-2 flex items-center gap-2">
                                <span th:if="${post.isSecret == 'Y'}"
                                    class="material-symbols-outlined text-base text-gray-500">lock</span>
                                <span th:text="${post.isSecret == 'Y'} ? 'ÎπÑÎ∞ÄÍ∏ÄÏûÖÎãàÎã§.' : ${post.title}"
                                    th:classappend="${post.isSecret == 'Y'} ? 'text-gray-500 dark:text-gray-400' : ''">
                                    AI Î∂ÑÏÑù Í∏∞Îä• 2.0 ÏóÖÎç∞Ïù¥Ìä∏ ÎÖ∏Ìä∏
                                </span>
                            </h3>

                            <!-- ÎÇ¥Ïö© Ìïú Ï§Ñ ÎØ∏Î¶¨Î≥¥Í∏∞ (ÎπÑÎ∞ÄÍ∏ÄÏù¥Î©¥ Ïà®ÍπÄ) -->
                            <p class="text-sm text-text-light/60 dark:text-text-dark/60 dark:text-text-dark/60 line-clamp-1"
                                th:if="${post.isSecret != 'Y'}">
                                <span th:text="${post.content}">Îçî Ï†ïÌôïÌï¥ÏßÑ AI ÏùòÎ•ò Î∂ÑÏÑù Í∏∞Îä•ÏùÑ ÎßåÎÇòÎ≥¥ÏÑ∏Ïöî.</span>
                            </p>
                        </div>

                        <div class="flex flex-col items-end gap-1">
                            <span class="text-xs text-text-light/40 dark:text-text-dark/40 whitespace-nowrap"
                                th:text="${#temporals.format(post.createdAt, 'yyyy.MM.dd')}">
                                2025.04.10
                            </span>
                            <span class="text-[11px] text-text-light/40 dark:text-text-dark/40"
                                th:text="|Ï°∞Ìöå ${post.viewCount}|">
                                Ï°∞Ìöå 0
                            </span>
                        </div>
                    </div>
                </a>
            </div>

            <!-- Pagination -->
            <div th:if="${page != null and page.totalPages > 0}" class="flex justify-center mt-12 gap-2">
                <!-- Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ -->
                <a th:if="${page.hasPrevious()}"
                    th:href="@{/community(page=${page.number - 1}, category=${currentCategory}, keyword=${keyword})}"
                    class="size-10 rounded-lg flex items-center justify-center hover:bg-card-light dark:hover:bg-card-dark text-text-light/50 dark:text-text-dark/50">
                    <span class="material-symbols-outlined">chevron_left</span>
                </a>
                <span th:unless="${page.hasPrevious()}"
                    class="size-10 rounded-lg flex items-center justify-center text-text-light/30 dark:text-text-dark/30 cursor-not-allowed">
                    <span class="material-symbols-outlined">chevron_left</span>
                </span>

                <!-- ÌéòÏù¥ÏßÄ Î≤àÌò∏Îì§ -->
                <a th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
                    th:href="@{/community(page=${i}, category=${currentCategory}, keyword=${keyword})}"
                    th:text="${i + 1}"
                    class="size-10 rounded-lg flex items-center justify-center text-sm font-bold hover:bg-card-light dark:hover:bg-card-dark"
                    th:classappend="${i} == ${page.number} ?
                     ' bg-primary text-white shadow-lg shadow-primary/30' :
                     ' text-text-light/70 dark:text-text-dark/70'">
                    1
                </a>

                <!-- Îã§Ïùå ÌéòÏù¥ÏßÄ -->
                <a th:if="${page.hasNext()}"
                    th:href="@{/community(page=${page.number + 1}, category=${currentCategory}, keyword=${keyword})}"
                    class="size-10 rounded-lg flex items-center justify-center hover:bg-card-light dark:hover:bg-card-dark text-text-light/50 dark:text-text-dark/50">
                    <span class="material-symbols-outlined">chevron_right</span>
                </a>
                <span th:unless="${page.hasNext()}"
                    class="size-10 rounded-lg flex items-center justify-center text-text-light/30 dark:text-text-dark/30 cursor-not-allowed">
                    <span class="material-symbols-outlined">chevron_right</span>
                </span>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer th:replace="~{fragments/footer :: footerFragment}"></footer>
</body>

</html>